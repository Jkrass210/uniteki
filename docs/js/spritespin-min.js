!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.SpriteSpin={})}(this,function(e){"use strict";var t=function(e){this.data=e};function n(e){var n=t.prototype;for(var a in e)if(e.hasOwnProperty(a)){if(n[a])throw new Error("API method is already defined: "+a);n[a]=e[a]}return n}var a,r,i,o=window.jQuery||window.$;function s(e){var t=e.touches,n=e;return void 0===e.touches&&void 0!==e.originalEvent&&(t=e.originalEvent.touches),void 0!==t&&0<t.length&&(n=t[0]),{x:n.clientX||0,y:n.clientY||0}}function l(e,t,n){if(!(r||(a||(a=document.createElement("canvas")),a&&a.getContext&&(r=a.getContext("2d")))))return!1;if(t*n<=1048576)return!1;a.width=a.height=1,r.fillStyle="#FF00FF",r.fillRect(0,0,1,1),r.drawImage(e,1-t,0);try{var i=r.getImageData(0,0,1,1).data;return 255===i[0]&&0===i[1]&&255===i[2]}catch(e){return!1}}function u(e){var t=Math.floor(e.width||e.frameWidth||e.target.innerWidth()),n=Math.floor(e.height||e.frameHeight||e.target.innerHeight());return{aspect:t/n,height:n,width:t}}function c(e){var t=u(e);if("function"!=typeof window.getComputedStyle)return t;var n=window.getComputedStyle(e.target[0]);return n.width&&(t.width=Math.floor(Number(n.width.replace("px",""))),t.height=Math.floor(t.width/t.aspect)),t}function d(e){var t=Math.floor(e.frameWidth||e.width||e.target.innerWidth()),n=Math.floor(e.frameHeight||e.height||e.target.innerHeight());return{aspect:t/n,height:n,width:t}}function f(e,t,n){var a="fit"===e,r="fill"===e,i={width:"100%",height:"100%",top:0,left:0,bottom:0,right:0,position:"absolute",overflow:"hidden"};if(!e||"stretch"===e)return i;var o=t.aspect>=n.aspect,s=t.width,l=t.height;return(a&&o||r&&!o)&&(s=n.width,l=n.width/t.aspect),(r&&o||a&&!o)&&(l=n.height,s=n.height*t.aspect),s=Math.floor(s),l=Math.floor(l),i.width=s,i.height=l,i.top=Math.floor((n.height-l)/2),i.left=Math.floor((n.width-s)/2),i.right=i.left,i.bottom=i.top,i}function m(e){return e.naturalWidth?{height:e.naturalHeight,width:e.naturalWidth}:((i=i||new Image).src=e.src,{height:i.height,width:i.width})}function g(e,t){return 1===e.length?[h(e[0],t)]:t.framesX&&t.framesY?function(e,t){for(var n=[],a=0;a<e.length;a++){var r=h(e[a],{frames:void 0,framesX:t.framesX,framesY:t.framesY,detectSubsampling:t.detectSubsampling});r.id=a,n.push(r)}return n}(e,t):function(e,t){for(var n=[],a=0;a<e.length;a++){var r=h(e[a],{frames:1,framesX:1,detectSubsampling:t.detectSubsampling});r.id=a,n.push(r)}return n}(e,t)}function h(e,t){var n,a,r,i,o={id:0,sprites:[]};a=t,r=o,i=m(n=e),r.isSubsampled=a.detectSubsampling&&l(n,i.width,i.height),r.width=i.width,r.height=i.height,r.sampledWidth=i.width/(r.isSubsampled?2:1),r.sampledHeight=i.height/(r.isSubsampled?2:1);for(var s=t.frames,u=Number(t.framesX)||s,c=Math.ceil(s/u),d=Math.floor(o.width/u),f=Math.floor(o.height/c),g=o.isSubsampled?2:1,h=0;h<s;h++){var p=h%u*d,v=Math.floor(h/u)*f;o.sprites.push({id:h,x:p,y:v,width:d,height:f,sampledX:p/g,sampledY:v/g,sampledWidth:d/g,sampledHeight:f/g})}return o}function p(e,t,n,a){for(var r=a*t+n,i=0,o=null,s=null;s=e[i];){if(!(r>=s.sprites.length)){o=s.sprites[r];break}r-=s.sprites.length,i++}return{sprite:o,sheet:s}}function v(){}function w(e){var t,n=e.source;t="string"==typeof n?[n]:n;for(var a=[],r=e.preloadCount||t.length,i=e.initiated||v,o=e.progress||v,s=e.complete||v,l=0,u=!1,c=!1,d=function(){l+=1,o({index:function(e,t){for(var n=0;n<t.length;n++)if(t[n]===e)return n}(this,a),loaded:l,total:t.length,percent:Math.round(l/t.length*100)}),(c=c||this===a[0])&&!u&&r<=l&&(u=!0,s(a))},f=0,m=t;f<m.length;f++){var g=m[f],h=new Image;a.push(h),h.onload=h.onabort=h.onerror=d,h.src=g}i(a)}function b(e,t,n){for(var a=String(e);a.length<t;)a=String(n)+a;return a}function x(e,t){var n=t.digits||2,a=t.lanePlacer||"{lane}",r=t.framePlacer||"{frame}",i=0,o=0;t.frame&&(i=t.frame[0],o=t.frame[1]);var s=0,l=0;t.lane&&(s=t.lane[0],l=t.lane[1]);for(var u=[],c=s;c<=l;c+=1)for(var d=i;d<=o;d+=1)u.push(e.replace(a,b(c,n,"0")).replace(r,b(d,n,"0")));return u}var y="spritespin",k=["mousedown","mousemove","mouseup","mouseenter","mouseover","mouseleave","mousewheel","wheel","click","dblclick","touchstart","touchmove","touchend","touchcancel","selectstart","gesturestart","gesturechange","gestureend"],X=["onInit","onProgress","onLoad","onFrameChanged","onFrame","onDraw","onComplete","onDestroy"],M=["dragstart"],S={source:void 0,width:void 0,height:void 0,frames:void 0,framesX:void 0,lanes:1,sizeMode:void 0,renderer:"canvas",lane:0,frame:0,frameTime:40,animate:!0,retainAnimate:!1,reverse:!1,loop:!0,stopFrame:0,wrap:!0,wrapLane:!1,sense:1,senseLane:void 0,orientation:"horizontal",detectSubsampling:!0,preloadCount:void 0,responsive:void 0,plugins:["360","drag"]};function F(){}function Y(e){return console&&console[e]?function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return console.log.apply(console,e)}:F}var T=Y("log"),z=Y("warn"),C=Y("error");function R(e){return Array.isArray(e)?e:[e]}function P(e,t,n){return n<e?n:e<t?t:e}function E(e,t,n,a){for(;n<e;)e-=a;for(;e<t;)e+=a;return e}function A(e){return e.preventDefault(),!1}function D(e,t,n){n&&e.bind(t+"."+y,function(t){n.apply(e,[t,e.spritespin("data")])})}function I(e){e.unbind("."+y)}function W(e){return(window.devicePixelRatio||1)/(e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1)}var H=Object.freeze({$:o,getCursorPosition:s,detectSubsampling:l,getOuterSize:u,getComputedSize:c,getInnerSize:d,getInnerLayout:f,measure:g,findSpecs:p,naturalSize:m,preload:w,sourceArray:x,noop:F,log:T,warn:z,error:C,toArray:R,clamp:P,wrap:E,prevent:A,bind:D,unbind:I,isFunction:function(e){return"function"==typeof e},pixelRatio:W});function L(e){e.target.attr("unselectable","on").css({width:"",height:"","-ms-user-select":"none","-moz-user-select":"none","-khtml-user-select":"none","-webkit-user-select":"none","user-select":"none"});var t=e.responsive?c(e):u(e),n=f(e.sizeMode,d(e),t);e.target.css({width:t.width,height:t.height,position:"relative",overflow:"hidden"}),e.stage.css(n).hide(),e.canvas&&(e.canvas.css(n).hide(),e.canvasRatio=e.canvasRatio||W(e.context),"number"==typeof n.width&&"number"==typeof n.height?(e.canvas[0].width=n.width*e.canvasRatio||t.width,e.canvas[0].height=n.height*e.canvasRatio||t.height):(e.canvas[0].width=t.width*e.canvasRatio,e.canvas[0].height=t.height*e.canvasRatio),e.context.scale(e.canvasRatio,e.canvasRatio))}function O(e,t){return e.state=e.state||{},e.state[t]=e.state[t]||{},e.state[t]}function q(e,t){var n=O(e,"plugin");return n[t]=n[t]||{},n[t]}function B(e,t){return!!O(e,"flags")[t]}function N(e,t,n){O(e,"flags")[t]=!!n}function j(e){return O(e,"playback")}function U(e){var t=j(e);t.lastFrame=e.frame,t.lastLane=e.lane}function _(e){var t=j(e);t.lastFrame===e.frame&&t.lastLane===e.lane||e.target.trigger("onFrameChanged."+y,e),e.target.trigger("onFrame."+y,e),e.target.trigger("onDraw."+y,e)}function Q(e,t,n){var a,r,i,o;U(e),null!=t&&(r=t,(a=e).frame=Number(r),a.frame=a.wrap?E(a.frame,0,a.frames-1,a.frames):P(a.frame,0,a.frames-1)),null!=n&&(o=n,(i=e).lane=i.wrapLane?E(o,0,i.lanes-1,i.lanes):P(o,0,i.lanes-1)),_(e)}function Z(e){e.animate=!1;var t=j(e);null!=t.handler&&(window.clearInterval(t.handler),t.handler=null)}function G(e){var t=j(e);!t.handler||e.animate&&t.frameTime===e.frameTime||Z(e),e.animate&&!t.handler&&(t.frameTime=e.frameTime,t.handler=window.setInterval(function(){return function(e){var t;j(e).handler&&(U(e),(t=e).frame+=t.reverse?-1:1,t.frame=E(t.frame,0,t.frames-1,t.frames),t.loop||t.frame!==t.stopFrame||Z(t),_(e))}(e)},t.frameTime))}function J(e){e.animate=!0,G(e)}var K={};function V(e,t){if(!K[e])return t=t||{},K[e]=t;C('Plugin name "'+e+'" is already taken')}function ee(e){return K[e]}function te(e){!function(e){e.mods&&(z('"mods" option is deprecated, use "plugins" instead'),e.plugins=e.mods,delete e.mods),e.behavior&&(z('"behavior" option is deprecated, use "plugins" instead'),e.plugins.push(e.behavior),delete e.behavior),e.module&&(z('"module" option is deprecated, use "plugins" instead'),e.plugins.push(e.module),delete e.module)}(e);for(var t=0;t<e.plugins.length;t+=1){var n=e.plugins[t];if("string"==typeof n){var a=ee(n);a?e.plugins[t]=a:C("No plugin found with name "+n)}}}var ne=o,ae=0,re={};function ie(e){for(var t in re)re.hasOwnProperty(t)&&e(re[t])}var oe=function(){function e(){ie(function(e){e.responsive&&le(e)})}oe=function(){};for(var t=function(e){ne(window.document).bind(e+"."+y,function(t){var n,a;n="document"+e,a=t,ie(function(e){for(var t=0,r=e.plugins;t<r.length;t++){var i=r[t];"function"==typeof i[n]&&i[n].apply(e.target,[a,e])}})})},n=0,a=k;n<a.length;n++)t(a[n]);var r=null;ne(window).on("resize",function(){window.clearTimeout(r),r=window.setTimeout(e,100)})};function se(e){var t=e.target;I(t);for(var n=0,a=M;n<a.length;n++)D(t,m=a[n],A);for(var r=0,i=e.plugins;r<i.length;r++){for(var o=i[r],s=0,l=k;s<l.length;s++)D(t,m=l[s],o[m]);for(var u=0,c=X;u<c.length;u++)D(t,m=c[u],o[m])}D(t,"onLoad",function(e,t){G(t)});for(var d=0,f=X;d<f.length;d++){var m;D(t,m=f[d],e[m])}}function le(e){te(e),se(e),L(e),e.source=R(e.source),e.loading=!0,e.target.addClass("loading").trigger("onInit."+y,e),w({source:e.source,preloadCount:e.preloadCount,progress:function(t){e.progress=t,e.target.trigger("onProgress."+y,e)},complete:function(t){e.images=t,e.loading=!1,e.frames=e.frames||t.length,function(e){e.images||(e.metrics=[]),e.metrics=g(e.images,e);var t=p(e.metrics,e.frames,0,0);t.sprite&&(e.frameWidth=t.sprite.width,e.frameHeight=t.sprite.height)}(e),L(e),e.stage.show(),e.target.removeClass("loading").trigger("onLoad."+y,e).trigger("onFrame."+y,e).trigger("onDraw."+y,e).trigger("onComplete."+y,e)}})}function ue(e){var t,n=this,a=e.target,r=ne.extend(!0,{},S,e);if(r.source=r.source||[],r.plugins=r.plugins||[],a.find("img").each(function(){Array.isArray(r.source)||(r.source=[]),r.source.push(ne(n).attr("src"))}),a.empty().addClass("spritespin-instance").append("<div class='spritespin-stage'></div>"),"canvas"===r.renderer){var i=document.createElement("canvas");i.getContext&&i.getContext("2d")?(r.canvas=ne(i).addClass("spritespin-canvas"),r.context=i.getContext("2d"),a.append(r.canvas),a.addClass("with-canvas")):r.renderer="image"}return r.target=a,r.stage=a.find(".spritespin-stage"),a.data(y,r),ae+=1,(t=r).id=String(ae),re[t.id]=t,r}function ce(e){oe();var t=e.target.data(y);return t?ne.extend(t,e):t=ue(e),le(t),t}function de(e){delete re[e.id],Z(e),e.target.trigger("onDestroy",e).html(null).attr("style",null).attr("unselectable",null).removeClass(["spritespin-instance","with-canvas"]),I(e.target),e.target.removeData(y)}function fe(e){return O(e,"input")}function me(e,t){var n=s(e),a=fe(t);a.oldX=a.currentX,a.oldY=a.currentY,a.currentX=n.x,a.currentY=n.y,void 0!==a.oldX&&void 0!==a.oldY||(a.oldX=a.currentX,a.oldY=a.currentY),void 0!==a.startX&&void 0!==a.startY||(a.startX=a.currentX,a.startY=a.currentY,a.clickframe=t.frame,a.clicklane=t.lane),a.dX=a.currentX-a.startX,a.dY=a.currentY-a.startY,a.ddX=a.currentX-a.oldX,a.ddY=a.currentY-a.oldY,a.ndX=a.dX/t.target.innerWidth(),a.ndY=a.dY/t.target.innerHeight(),a.nddX=a.ddX/t.target.innerWidth(),a.nddY=a.ddY/t.target.innerHeight()}function ge(e){var t=fe(e);t.startX=t.startY=void 0,t.currentX=t.currentY=void 0,t.oldX=t.oldY=void 0,t.dX=t.dY=0,t.ddX=t.ddY=0,t.ndX=t.ndY=0,t.nddX=t.nddY=0}function he(e,t){for(var n=0,a=t;n<a.length;n++){var r=a[n];if(e[r]||r in e)return r}return t[0]}o.fn[y]=function(e,n){var a,r=o(this);if("data"===e)return r.data(y);if("api"===e){var i=r.data(y);return i.api=i.api||new t(i),i.api}if("destroy"===e)return r.each(function(){var e=r.data(y);e&&de(e)});if(2===arguments.length&&"string"==typeof e&&((a={})[e]=n,e=a),"object"==typeof e)return ce(o.extend(!0,{target:r},e)).target;throw new Error("Invalid call to spritespin")},n({isPlaying:function(){return null!=j(this.data).handler},isLooping:function(){return this.data.loop},toggleAnimation:function(){this.isPlaying()?this.stopAnimation():this.startAnimation()},stopAnimation:function(){this.data.animate=!1,Z(this.data)},startAnimation:function(){this.data.animate=!0,G(this.data)},loop:function(e){return this.data.loop=e,G(this.data),this},currentFrame:function(){return this.data.frame},updateFrame:function(e){return Q(this.data,e),this},skipFrames:function(e){var t=this.data;return Q(t,t.frame+(t.reverse?-e:+e)),this},nextFrame:function(){return this.skipFrames(1)},prevFrame:function(){return this.skipFrames(-1)},playTo:function(e,t){var n=this.data;if((t=t||{}).force||n.frame!==e){if(t.nearest){var a=e-n.frame,r=e>n.frame?a-n.frames:a+n.frames,i=Math.abs(a)<Math.abs(r)?a:r;n.reverse=i<0}return n.animate=!0,n.loop=!1,n.stopFrame=e,G(n),this}}});var pe={requestFullscreen:he(document.documentElement,["requestFullscreen","webkitRequestFullScreen","mozRequestFullScreen","msRequestFullscreen"]),exitFullscreen:he(document,["exitFullscreen","webkitExitFullscreen","webkitCancelFullScreen","mozCancelFullScreen","msExitFullscreen"]),fullscreenElement:he(document,["fullscreenElement","webkitFullscreenElement","webkitCurrentFullScreenElement","mozFullScreenElement","msFullscreenElement"]),fullscreenEnabled:he(document,["fullscreenEnabled","webkitFullscreenEnabled","mozFullScreenEnabled","msFullscreenEnabled"]),fullscreenchange:he(document,["onfullscreenchange","onwebkitfullscreenchange","onmozfullscreenchange","onMSFullscreenChange"]).replace(/^on/,""),fullscreenerror:he(document,["onfullscreenerror","onwebkitfullscreenerror","onmozfullscreenerror","onMSFullscreenError"]).replace(/^on/,"")},ve=pe.fullscreenchange+"."+y+"-fullscreen";function we(){o(document).unbind(ve)}var be="orientationchange."+y+"-fullscreen";function xe(){o(window).unbind(be)}function ye(){return document[pe.fullscreenElement]}function ke(){return!!ye()}n({fullscreenEnabled:function(){return document[pe.fullscreenEnabled]},fullscreenElement:ye,exitFullscreen:function(){return document[pe.exitFullscreen]()},toggleFullscreen:function(e){!function(e,t){ke()?this.apiRequestFullscreen(t):this.exitFullscreen()}(this.data,e)},requestFullscreen:function(e){!function(e,t){t=t||{};var n,a=e.width,r=e.height,i=e.source,s=e.sizeMode,l=e.responsive,u=function(){e.width=window.screen.width,e.height=window.screen.height,e.source=t.source||i,e.sizeMode=t.sizeMode||"fit",e.responsive=!1,le(e)};n=function(){var t;ke()?(u(),t=u,xe(),o(window).bind(be,t)):(we(),xe(),e.width=a,e.height=r,e.source=i,e.sizeMode=s,e.responsive=l,le(e))},we(),o(document).bind(ve,n),(e.target[0]||document.documentElement)[pe.requestFullscreen]()}(this.data,e)}}),function(){function e(e,t){if(!t.loading&&t.stage.is(":visible")){me(e,t);var n,a,r=fe(t),i=t.target,o=i.offset();"horizontal"===t.orientation?(n=i.innerWidth()/2,a=r.currentX-o.left):(n=i.innerHeight()/2,a=r.currentY-o.top),Q(t,t.frame+(n<a?1:-1))}}V("click",{name:"click",mouseup:e,touchend:e})}(),function(){var e="drag";function t(t){return q(t,e)}function n(e,n){var a=t(n);if(!n.loading&&!B(n,"dragging")&&n.stage.is(":visible")){var r=(new Date).getTime();a.startAt&&200<r-a.startAt&&e.preventDefault(),a.startAt=r,a.wasPlaying=!!j(n).handler,a.frame=n.frame||0,a.lane=n.lane||0,N(n,"dragging",!0),me(e,n)}}function a(e,n){B(n,"dragging")&&(N(n,"dragging",!1),ge(n),n.retainAnimate&&t(n).wasPlaying&&J(n))}function r(e,n){var a=t(n),r=fe(n);if(B(n,"dragging")){me(e,n);var i,o="number"==typeof(i=n).orientation?i.orientation*Math.PI/180:"horizontal"===i.orientation?0:Math.PI/2,s=Math.sin(o),l=Math.cos(o),u=(r.nddX*l-r.nddY*s)*n.sense||0,c=(r.nddX*s+r.nddY*l)*(n.senseLane||n.sense)||0;a.frame+=n.frames*u,a.lane+=n.lanes*c,n.frame,n.lane,Q(n,Math.floor(a.frame),Math.floor(a.lane)),Z(n)}}V("drag",{name:"drag",mousedown:n,mousemove:r,mouseup:a,documentmousemove:r,documentmouseup:a,touchstart:n,touchmove:r,touchend:a,touchcancel:a}),V("move",{name:"move",mousemove:function(e,t){n(e,t),r(e,t)},mouseleave:a,touchstart:n,touchmove:r,touchend:a,touchcancel:a})}(),function(){var e="hold";function t(t){return q(t,e)}function n(e,n){var a,r;B(n,"loading")||B(n,"dragging")||!n.stage.is(":visible")||((r=t(a=n)).frameTime=a.frameTime,r.animate=a.animate,r.reverse=a.reverse,me(e,n),N(n,"dragging",!0),n.animate=!0,G(n))}function a(e,n){var a,r;N(n,"dragging",!1),ge(n),Z(n),r=t(a=n),a.frameTime=r.frameTime,a.animate=r.animate,a.reverse=r.reverse,G(n)}function r(e,t){if(B(t,"dragging")){me(e,t);var n,a,r=fe(t),i=t.target,o=i.offset();"horizontal"===t.orientation?(n=i.innerWidth()/2,a=(r.currentX-o.left-n)/n):(n=t.height/2,a=(r.currentY-o.top-n)/n),t.reverse=a<0,a=a<0?-a:a,t.frameTime=80*(1-a)+20,("horizontal"===t.orientation&&r.dX<r.dY||"vertical"===t.orientation&&r.dX<r.dY)&&e.preventDefault()}}V(e,{name:e,mousedown:n,mousemove:r,mouseup:a,mouseleave:a,touchstart:n,touchmove:r,touchend:a,touchcancel:a,onFrame:function(e,t){t.animate=!0,G(t)}})}(),function(){var e="swipe";function t(t){return q(t,e)}function n(e,t,n){return e[t]||n}function a(e,t){t.loading||B(t,"dragging")||(me(e,t),N(t,"dragging",!0))}function r(e,t){B(t,"dragging")&&(me(e,t),Q(t,t.frame,t.lane))}function i(e,n){if(B(n,"dragging")){N(n,"dragging",!1);var a,r,i=t(n),o=fe(n),s=n.frame,l=n.lane,u=i.snap,c=i.fling;"horizontal"===n.orientation?(a=o.ndX,r=o.ddX):(a=o.ndY,r=o.ddY),u<=a||c<=r?s=n.frame-1:(a<=-u||r<=-c)&&(s=n.frame+1),ge(n),Q(n,s,l),Z(n)}}V(e,{name:e,onLoad:function(e,a){var r=t(a);r.fling=n(a,"swipeFling",10),r.snap=n(a,"swipeSnap",.5)},mousedown:a,mousemove:r,mouseup:i,mouseleave:i,touchstart:a,touchmove:r,touchend:i,touchcancel:i})}(),V("wheel",{name:"wheel",wheel:function(e,t){if(!t.loading&&t.stage.is(":visible")){e.preventDefault();var n=e.originalEvent,a=0===n.deltaX?0:0<n.deltaX?1:-1,r=0===n.deltaY?0:0<n.deltaY?1:-1;Q(t,t.frame+r,t.lane+a)}}}),function(){function e(e){return q(e,t)}var t="progress";V(t,{name:t,onInit:function(t,n){var a=e(n);a.stage||(a.stage=o("\n<div class='spritespin-progress'>\n  <div class='spritespin-progress-label'></div>\n  <div class='spritespin-progress-bar'></div>\n</div>\n"),a.stage.appendTo(n.target)),a.stage.find(".spritespin-progress-label").text("0%").css({"text-align":"center"}),a.stage.find(".spritespin-progress-bar").css({width:"0%"}),a.stage.hide().fadeIn()},onProgress:function(t,n){var a=e(n);a.stage.find(".spritespin-progress-label").text(n.progress.percent+"%").css({"text-align":"center"}),a.stage.find(".spritespin-progress-bar").css({width:n.progress.percent+"%"})},onLoad:function(t,n){o(e(n).stage).fadeOut()},onDestroy:function(t,n){o(e(n).stage).remove()}})}(),V("360",{name:"360",onLoad:function(e,t){t.stage.find(".spritespin-frames").detach(),"image"===t.renderer&&$(t.images).addClass("spritespin-frames").appendTo(t.stage)},onDraw:function(e,t){var n=p(t.metrics,t.frames,t.frame,t.lane),a=n.sheet,r=n.sprite;if(a&&r){var i=t.source[a.id],o=t.images[a.id];if("canvas"===t.renderer){t.canvas.show();var s=t.canvas[0].width/t.canvasRatio,l=t.canvas[0].height/t.canvasRatio;return t.context.clearRect(0,0,s,l),void t.context.drawImage(o,r.sampledX,r.sampledY,r.sampledWidth,r.sampledHeight,0,0,s,l)}var u=t.stage.innerWidth()/r.sampledWidth,c=t.stage.innerHeight()/r.sampledHeight,d=Math.floor(-r.sampledY*c),f=Math.floor(-r.sampledX*u),m=Math.floor(a.sampledWidth*u),g=Math.floor(a.sampledHeight*c);"background"!==t.renderer?($(t.images).hide(),$(o).show().css({position:"absolute",top:d,left:f,"max-width":"initial",width:m,height:g})):t.stage.css({"background-image":"url('"+i+"')","background-position":f+"px "+d+"px","background-repeat":"no-repeat","-webkit-background-size":m+"px "+g+"px","-moz-background-size":m+"px "+g+"px","-o-background-size":m+"px "+g+"px","background-size":m+"px "+g+"px"})}}}),function(){var e="blur";function t(t){return q(t,e)}function n(e,t,n){return e[t]||n}var a=[];function r(e,t,n){if(!(n.alpha<=0)){var a=p(e.metrics,e.frames,n.frame,n.lane),r=a.sheet,i=a.sprite;if(r&&i){e.source[r.id];var o=e.images[r.id];if(!1!==o.complete){t.canvas.show();var s=t.canvas[0].width/e.canvasRatio,l=t.canvas[0].height/e.canvasRatio;t.context.globalAlpha=n.alpha,t.context.drawImage(o,i.sampledX,i.sampledY,i.sampledWidth,i.sampledHeight,0,0,s,l)}}}}V(e,{name:e,onLoad:function(e,a){var r=t(a);r.canvas=r.canvas||o("<canvas class='blur-layer'></canvas>"),r.context=r.context||r.canvas[0].getContext("2d"),r.steps=r.steps||[],r.fadeTime=Math.max(n(a,"blurFadeTime",200),1),r.frameTime=Math.max(n(a,"blurFrameTime",a.frameTime),16),r.trackTime=null,r.cssBlur=!!n(a,"blurCss",!1);var i=d(a),s=a.responsive?c(a):u(a),l=f(a.sizeMode,i,s);r.canvas[0].width=a.width*a.canvasRatio,r.canvas[0].height=a.height*a.canvasRatio,r.canvas.css(l).show(),r.context.scale(a.canvasRatio,a.canvasRatio),a.target.append(r.canvas)},onFrameChanged:function(e,n){var i,o,s,l,u=t(n);o=t(i=n),s=j(i),l=(l=Math.abs(i.frame-s.lastFrame))>=i.frames/2?i.frames-l:l,o.steps.unshift({frame:i.frame,lane:i.lane,live:1,step:o.frameTime/o.fadeTime,d:l,alpha:0}),null==u.timeout&&function e(n){var i=t(n);i.timeout=window.setTimeout(function(){!function(n){var i=t(n);if(o=t(n),window.clearTimeout(o.timeout),o.timeout=null,i.context){var o,s,l,u,c=0;(function(e,t){t.canvas.show(),t.canvas[0].width,e.canvasRatio,t.canvas[0].height,e.canvasRatio})(n,i),i.context.clearRect(0,0,n.width,n.height);for(var d=0,f=i.steps;d<f.length;d++){var m=f[d];m.live=Math.max(m.live-m.step,0),m.alpha=Math.max(m.live-.25,0),r(n,i,m),c+=m.alpha+m.d}i.cssBlur&&(s=i.canvas,l=c,u="blur("+Math.min(Math.max(l/2-4,0),2.5)+"px)",s.css({"-webkit-filter":u,filter:u})),function(e){for(var t=a.length=0;t<e.length;t+=1)e[t].alpha<=0&&a.push(t);for(var n=0,r=a;n<r.length;n++){var i=r[n];e.splice(i,1)}}(i.steps),i.steps.length&&e(n)}}(n)},i.frameTime)}(n)}})}(),function(){var e=Math.max,t=Math.min,n="ease";function a(e){return q(e,n)}function r(e,t,n){return e[t]||n}function i(e,t){B(t,"dragging")&&(s(t),function(e){var t=a(e);for(t.samples.push({time:(new Date).getTime(),frame:e.frame,lane:e.lane});t.samples.length>t.maxSamples;)t.samples.shift()}(t))}function o(e,t){for(var n,r=a(t),i=r.samples,o=0,l=0,u=0,c=0,d=i;c<d.length;c++){var f=d[c];if(n){var m=f.time-n.time;if(m>r.abortTime)return o=l=u=0,s(t);l+=f.frame-n.frame,o+=f.lane-n.lane,u+=m,n=f}else n=f}i.length=0,u&&(r.lane=t.lane,r.lanes=0,r.laneStep=o/u*r.updateTime,r.frame=t.frame,r.frames=0,r.frameStep=l/u*r.updateTime,function e(t){var n=a(t);n.handler=window.setTimeout(function(){!function(t){var n=a(t);n.lanes+=n.laneStep,n.frames+=n.frameStep,n.laneStep*=n.damping,n.frameStep*=n.damping;var r=Math.floor(n.frame+n.frames),i=Math.floor(n.lane+n.lanes);Q(t,r,i),B(t,"dragging")?s(t):.005<Math.abs(n.frameStep)||.005<Math.abs(n.laneStep)?e(t):s(t)}(t)},n.updateTime)}(t))}function s(e){var t=a(e);null!=t.handler&&(window.clearTimeout(t.handler),t.handler=null)}V(n,{name:n,onLoad:function(n,i){var o=a(i);o.maxSamples=e(r(i,"easeMaxSamples",5),0),o.damping=e(t(r(i,"easeDamping",.9),.999),0),o.abortTime=e(r(i,"easeAbortTime",250),16),o.updateTime=e(r(i,"easeUpdateTime",i.frameTime),16),o.samples=[],o.steps=[]},mousemove:i,mouseup:o,mouseleave:o,touchmove:i,touchend:o,touchcancel:o})}(),function(){var e="gallery";function t(t){return q(t,e)}function n(e,t,n){return e[t]||n}V(e,{name:e,onLoad:function(e,a){var r=t(a);r.images=[],r.offsets=[],r.frame=a.frame,r.speed=n(a,"gallerySpeed",500),r.opacity=n(a,"galleryOpacity",.25),r.stage=n(a,"galleryStage",o("<div></div>")),r.stage.empty().addClass("gallery-stage").prependTo(a.stage);for(var i=0,s=0,l=a.images;s<l.length;s++){var g=l[s],h=m(g),p=a.height/h.height,v=o(g);r.stage.append(v),r.images.push(v),r.offsets.push(-i+(a.width-g.width*p)/2),i+=a.width,v.css({"max-width":"initial",opacity:r.opacity,width:a.width,height:a.height})}var w=d(a),b=a.responsive?c(a):u(a),x=f(a.sizeMode,w,b);r.stage.css(x).css({width:i,left:r.offsets[r.frame]}),r.images[r.frame].animate({opacity:1},{duration:r.speed})},onDraw:function(e,n){var a=t(n),r=fe(n),i=B(n,"dragging");a.frame===n.frame||i?(i||a.dX!==r.dX)&&(a.dX=r.dX,a.ddX=r.ddX,a.stage.stop(!0,!0).css({left:a.offsets[a.frame]+a.dX})):(a.stage.stop(!0,!1).animate({left:a.offsets[n.frame]},{duration:a.speed}),a.images[a.frame].animate({opacity:a.opacity},{duration:a.speed}),a.frame=n.frame,a.images[a.frame].animate({opacity:1},{duration:a.speed}),a.stage.animate({left:a.offsets[a.frame]}))}})}(),function(){var e="panorama";function t(t){return q(t,e)}V(e,{name:e,onLoad:function(e,n){var a=t(n),r=n.metrics[0];if(r){"horizontal"===n.orientation?(a.scale=n.target.innerHeight()/r.sampledHeight,n.frames=r.sampledWidth):(a.scale=n.target.innerWidth()/r.sampledWidth,n.frames=r.sampledHeight);var i=Math.floor(r.sampledWidth*a.scale),o=Math.floor(r.sampledHeight*a.scale);n.stage.css({"background-image":"url("+n.source[r.id]+")","background-repeat":"repeat-both","-webkit-background-size":i+"px "+o+"px","-moz-background-size":i+"px "+o+"px","-o-background-size":i+"px "+o+"px","background-size":i+"px "+o+"px"})}},onDraw:function(e,n){var a=t(n),r="horizontal"===n.orientation?1:0,i=r?0:1,o=n.frame%n.frames,s=Math.round(r*o*a.scale),l=Math.round(i*o*a.scale);n.stage.css({"background-position":s+"px "+l+"px"})}})}(),function(){var e="zoom";function t(t){return q(t,e)}function a(e,t,n){return e[t]||n}function r(e,n){var a=t(n);if(a.stage.is(":visible")){e.preventDefault(),N(n,"dragging",!1);var r=s(e),i=r.x/n.width,o=r.y/n.height;null==a.oldX&&(a.oldX=i,a.oldY=o),null==a.currentX&&(a.currentX=i,a.currentY=o);var l=i-a.oldX,u=o-a.oldY;a.oldX=i,a.oldY=o,e.type.match(/touch/)&&(l=-l,u=-u),a.currentX=P(a.currentX+l,0,1),a.currentY=P(a.currentY+u,0,1),Q(n,n.frame,n.lane)}}function i(e,n){e.preventDefault();var a=t(n),i=(new Date).getTime();a.clickTime?i-a.clickTime>a.doubleClickTime?a.clickTime=i:(a.clickTime=void 0,u(n)&&r(e,n)):a.clickTime=i}function l(e,n){t(n).stage.is(":visible")&&r(e,n)}function u(e){var n=t(e);if(!n.stage)throw new Error("zoom module is not initialized or is not available.");return n.stage.is(":visible")?(n.stage.fadeOut(),e.stage.fadeIn(),!1):(n.stage.fadeIn(),e.stage.fadeOut(),!0)}V(e,{name:e,mousedown:i,touchstart:i,mousemove:l,touchmove:l,onInit:function(e,n){var r=t(n);r.source=a(n,"zoomSource",n.source),r.doubleClickTime=a(n,"zoomDoubleClickTime",500),r.stage=r.stage||o("<div class='zoom-stage'></div>"),r.stage.css({width:"100%",height:"100%",top:0,left:0,bottom:0,right:0,position:"absolute"}).appendTo(n.target).hide()},onDestroy:function(e,n){var a=t(n);a.stage&&(a.stage.remove(),delete a.stage)},onDraw:function(e,n){var a=t(n),r=n.lane*n.frames+n.frame,i=a.source[r],o=p(n.metrics,n.frames,n.frame,n.lane),s=a.currentX,l=a.currentY;if(null==s&&(s=a.currentX=.5,l=a.currentY=.5),i)s=Math.floor(100*s),l=Math.floor(100*l),a.stage.css({"background-repeat":"no-repeat","background-image":"url('"+i+"')","background-position":s+"% "+l+"%"});else if(o.sheet&&o.sprite){var u=o.sprite,c=o.sheet,d=n.source[c.id],f=-Math.floor(u.sampledX+s*(u.sampledWidth-n.width)),m=-Math.floor(u.sampledY+l*(u.sampledHeight-n.height)),g=c.sampledWidth,h=c.sampledHeight;a.stage.css({"background-image":"url('"+d+"')","background-position":f+"px "+m+"px","background-repeat":"no-repeat","-webkit-background-size":g+"px "+h+"px","-moz-background-size":g+"px "+h+"px","-o-background-size":g+"px "+h+"px","background-size":g+"px "+h+"px"})}}}),n({toggleZoom:function(){u(this.data)}})}();var Xe=H;e.Utils=Xe,e.sourceArray=x,e.Api=t,e.extendApi=n,e.instances=re,e.applyEvents=se,e.boot=le,e.create=ue,e.createOrUpdate=ce,e.destroy=de,e.namespace=y,e.eventNames=k,e.callbackNames=X,e.eventsToPrevent=M,e.defaults=S,e.getInputState=fe,e.updateInput=me,e.resetInput=ge,e.applyLayout=L,e.getPlaybackState=j,e.updateFrame=Q,e.stopAnimation=Z,e.applyAnimation=G,e.startAnimation=J,e.registerPlugin=V,e.registerModule=function(e,t){z('"registerModule" is deprecated, use "registerPlugin" instead'),V(e,t)},e.getPlugin=ee,e.applyPlugins=te,e.getState=O,e.getPluginState=q,e.is=B,e.flag=N,Object.defineProperty(e,"__esModule",{value:!0})});